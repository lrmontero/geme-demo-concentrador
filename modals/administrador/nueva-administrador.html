<!-- MODAL NUEVA SOLICITUD ADMINISTRADOR -->
<div class="modal fade" id="modalNuevaAdmin" tabindex="-1" role="dialog" aria-labelledby="modalNuevaAdminLabel" aria-hidden="true" data-backdrop="true" data-keyboard="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalNuevaAdminLabel">
                    <i class="fas fa-plus-circle mr-2"></i>Nueva Solicitud - Administrador
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Leyenda de campos obligatorios -->
                <div class="alert alert-info mb-3" role="alert">
                    <i class="fas fa-info-circle mr-2"></i>
                    <strong>Leyenda:</strong>
                    <span class="ml-3"><span class="text-danger">*</span> Campos obligatorios</span>
                </div>
                
                <form id="formNuevaSolicitud">
                    <!-- Header: Estado -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-info-circle mr-2"></i>Estado</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="alert alert-secondary mb-0" role="alert">
                                        <i class="fas fa-cog mr-2"></i>
                                        <strong>Estado por defecto:</strong> <span class="badge badge-secondary ml-2">Administrador Gestionando</span>
                                        <small class="d-block mt-1 text-muted">Las solicitudes creadas por el administrador inician en este estado</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Identificación -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-id-card mr-2"></i>Identificación</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">ID Solicitud</label>
                                        <input type="text" class="form-control" id="nuevaIDSolicitud" name="idSolicitud" placeholder="Ej: CEN-2025-001">
                                        <small class="form-text text-muted">ID de la solicitud CEN o SODI (Opcional)</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Tipo <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaTipo" name="tipo" required>
                                            <option value="">Seleccione...</option>
                                            <option value="SDCN">SDCN - Solicitud de Desconexión Cliente No Facturado</option>
                                            <option value="SDCF">SDCF - Solicitud de Desconexión Cliente Facturado</option>
                                            <option value="SICN">SICN - Solicitud de Intervención Cliente No Facturado</option>
                                            <option value="SICF">SICF - Solicitud de Intervención Cliente Facturado</option>
                                            <option value="IL">IL - Intervención en Línea</option>
                                            <option value="MM">MM - Mantención Mayor</option>
                                            <option value="SODI">SODI - Solicitud de Disponibilidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Relación SODI/CEN</label>
                                        <textarea class="form-control" id="nuevaRelacionSODICEN" name="relacionSODICEN" rows="2" placeholder="Ej: CEN-2025-001, SODI-123"></textarea>
                                        <small class="form-text text-muted">Opcional</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Fechas Programadas -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="far fa-calendar-alt mr-2"></i>Fechas Programadas</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Fecha y hora programada de inicio <span class="text-danger">*</span></label>
                                        <input type="datetime-local" class="form-control" id="nuevaInicioProgramado" name="inicioProgramado" required>
                                        <small class="form-text text-muted">Debe ser una fecha futura</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Fecha y hora programada de fin <span class="text-danger">*</span></label>
                                        <input type="datetime-local" class="form-control" id="nuevaFinProgramado" name="finProgramado" required>
                                        <small class="form-text text-muted">Debe ser posterior a la fecha de inicio</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Empresas Involucradas -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-building mr-2"></i>Empresas Involucradas</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Empresa Solicitante <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaEmpresaSolicitante" name="empresaSolicitante" required>
                                            <option value="">Seleccione...</option>
                                            <option value="CDC">CDC</option>
                                            <option value="GM">GM</option>
                                            <option value="Transelec Norte">Transelec Norte</option>
                                            <option value="Transelec Sur">Transelec Sur</option>
                                            <option value="Chilquinta">Chilquinta</option>
                                            <option value="Saesa">Saesa</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Empresa Receptora <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaEmpresaReceptora" name="empresaReceptora" required>
                                            <option value="">Seleccione...</option>
                                            <option value="CDC">CDC</option>
                                            <option value="GM">GM</option>
                                            <option value="Transelec Norte">Transelec Norte</option>
                                            <option value="Transelec Sur">Transelec Sur</option>
                                            <option value="Chilquinta">Chilquinta</option>
                                            <option value="Saesa">Saesa</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Instalación y Equipos -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-cogs mr-2"></i>Instalación y Equipos</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Instalación GM <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaInstalacionGM" name="instalacionGM" required onchange="cargarEquiposPorInstalacion(this.value, 'nuevaEquipos')">
                                            <option value="">Seleccione...</option>
                                            <option value="Santiago Solar">Santiago Solar</option>
                                            <option value="Nueva Renca">Nueva Renca</option>
                                            <option value="Los Vientos">Los Vientos</option>
                                            <option value="Santa Lidia">Santa Lidia</option>
                                            <option value="CEME1">CEME1</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Instalaciones/Equipos a intervenir <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaEquipos" name="equipos" required disabled>
                                            <option value="">Primero seleccione Instalación GM</option>
                                        </select>
                                        <small class="form-text text-muted">Seleccione primero la instalación</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Características de la Intervención -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-tools mr-2"></i>Características de la Intervención</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Tipo de Intervención <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaTipoIntervencion" name="tipoIntervencion" required>
                                            <option value="">Seleccione...</option>
                                            <option value="Intervención">Intervención</option>
                                            <option value="Desconexión">Desconexión</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Potencia (MWH) <span class="text-danger">*</span></label>
                                        <input type="number" class="form-control" id="nuevaPotencia" name="potencia" step="0.01" min="0" required placeholder="Ej: 150.50">
                                        <small class="form-text text-muted">Potencia involucrada en MWH</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Aplica SODI <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaAplicaSODI" name="aplicaSODI" required onchange="toggleSODIAdjunto()">
                                            <option value="">Seleccione...</option>
                                            <option value="Sí">Sí</option>
                                            <option value="No">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Clasificación del Riesgo <span class="text-danger">*</span></label>
                                        <select class="form-control" id="nuevaRiesgo" name="riesgo" required onchange="toggleDescripcionRiesgo()">
                                            <option value="">Seleccione...</option>
                                            <option value="Bajo">Bajo</option>
                                            <option value="Medio">Medio</option>
                                            <option value="Alto">Alto</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6" id="nuevaDescripcionRiesgoContainer" style="display: none;">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Descripción del Riesgo <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="nuevaDescripcionRiesgo" name="descripcionRiesgo" rows="2" placeholder="Describa el riesgo identificado..."></textarea>
                                        <small class="form-text text-muted">Obligatorio para riesgo Medio o Alto</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Descripción y Condiciones -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-file-alt mr-2"></i>Descripción y Condiciones</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Descripción del trabajo a realizar <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="nuevaDescripcion" name="descripcion" rows="3" required minlength="10" placeholder="Describa detalladamente el trabajo a realizar..."></textarea>
                                        <small class="form-text text-muted">Mínimo 10 caracteres</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Condiciones requeridas <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="nuevaCondiciones" name="condiciones" rows="3" required placeholder="Especifique las condiciones necesarias para realizar el trabajo..."></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Comentarios</label>
                                        <textarea class="form-control" id="nuevaComentarios" name="comentarios" rows="2" placeholder="Comentarios adicionales (opcional)..."></textarea>
                                        <small class="form-text text-muted">Opcional</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Afectaciones</label>
                                        <select class="form-control" id="nuevaAfectaciones" name="afectaciones" onchange="toggleDescripcionAfectacion()">
                                            <option value="">Seleccione...</option>
                                            <option value="SSCC">SSCC</option>
                                            <option value="Protecciones">Protecciones</option>
                                            <option value="Medidores">Medidores</option>
                                        </select>
                                        <small class="form-text text-muted">Opcional</small>
                                    </div>
                                </div>
                                <div class="col-md-6" id="nuevaDescripcionAfectacionContainer" style="display: none;">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">Descripción de la Afectación <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="nuevaDescripcionAfectacion" name="descripcionAfectacion" rows="3" placeholder="Describa la afectación..."></textarea>
                                        <small class="form-text text-muted">Obligatorio si selecciona afectaciones</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Archivos Adjuntos -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0 text-primary"><i class="fas fa-paperclip mr-2"></i>Archivos Adjuntos</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <label class="text-muted small mb-1">Carga de archivo</label>
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="nuevaAdjunto" name="adjunto" accept=".pdf,.doc,.docx,.xls,.xlsx">
                                            <label class="custom-file-label" for="nuevaAdjunto">Seleccionar archivo...</label>
                                        </div>
                                        <small class="form-text text-muted">Formatos permitidos: PDF, Word, Excel (Opcional)</small>
                                    </div>
                                </div>
                                <div class="col-md-4" id="nuevaSODIAdjuntoContainer" style="display: none;">
                                    <div class="form-group mb-0">
                                        <label class="text-muted small mb-1">SODI Adjunta</label>
                                        <select class="form-control" id="nuevaSODIAdjunto" name="sodiAdjunto">
                                            <option value="">Seleccione...</option>
                                            <option value="Sí">Sí</option>
                                            <option value="No">No</option>
                                        </select>
                                        <small class="form-text text-muted">¿El archivo es una SODI?</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="guardarSolicitud()">
                    <i class="fas fa-save mr-2"></i>Guardar Solicitud
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Función para mostrar/ocultar descripción del riesgo según clasificación
function toggleDescripcionRiesgo() {
    const riesgo = document.getElementById('nuevaRiesgo').value;
    const container = document.getElementById('nuevaDescripcionRiesgoContainer');
    const textarea = document.getElementById('nuevaDescripcionRiesgo');
    
    if (riesgo === 'Medio' || riesgo === 'Alto') {
        container.style.display = 'block';
        textarea.setAttribute('required', 'required');
    } else {
        container.style.display = 'none';
        textarea.removeAttribute('required');
        textarea.value = '';
    }
}

// Función para mostrar/ocultar descripción de afectación
function toggleDescripcionAfectacion() {
    const afectacion = document.getElementById('nuevaAfectaciones').value;
    const container = document.getElementById('nuevaDescripcionAfectacionContainer');
    const textarea = document.getElementById('nuevaDescripcionAfectacion');
    
    if (afectacion && afectacion !== '') {
        container.style.display = 'block';
        textarea.setAttribute('required', 'required');
    } else {
        container.style.display = 'none';
        textarea.removeAttribute('required');
        textarea.value = '';
    }
}

// Función para mostrar/ocultar campo SODI Adjunta
function toggleSODIAdjunto() {
    const aplicaSODI = document.getElementById('nuevaAplicaSODI').value;
    const container = document.getElementById('nuevaSODIAdjuntoContainer');
    
    if (aplicaSODI === 'Sí') {
        container.style.display = 'block';
    } else {
        container.style.display = 'none';
        document.getElementById('nuevaSODIAdjunto').value = '';
    }
}
</script>
